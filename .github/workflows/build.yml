name: Build ArenaCull

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest

    steps:
    - uses: actions/checkout@v3

    - name: Compile App
      run: |
        # 1. 创建 App 文件夹结构
        mkdir -p ArenaCull.app/Contents/MacOS
        mkdir -p ArenaCull.app/Contents/Resources
        
        # 2. 编译 Swift 代码
        # 这一步会把 main.swift 变成可执行程序
        swiftc main.swift -o ArenaCull.app/Contents/MacOS/ArenaCull -target arm64-apple-macosx11.0 -framework SwiftUI -framework ImageIO -framework AppKit
        
        # 3. 创建 Info.plist 配置信息
        # 这是为了让 App 有图标(虽然是默认的)并能请求文件权限
        cat <<EOF > ArenaCull.app/Contents/Info.plist
        <?xml version="1.0" encoding="UTF-8"?>
        <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
        <plist version="1.0">
        <dict>
            <key>CFBundleExecutable</key>
            <string>ArenaCull</string>
            <key>CFBundleIdentifier</key>
            <string>com.user.arenacull</string>
            <key>CFBundleName</key>
            <string>ArenaCull</string>
            <key>CFBundlePackageType</key>
            <string>APPL</string>
            <key>LSMinimumSystemVersion</key>
            <string>11.0</string>
            <key>NSFileAccessUsageDescription</key>
            <string>Need access to read photos.</string>
        </dict>
        </plist>
        EOF

    - name: Zip the App
      run: zip -r ArenaCull.zip ArenaCull.app

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: ArenaCull-App
        path: ArenaCull.zip
